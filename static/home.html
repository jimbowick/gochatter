<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chat Example</title>
    <script type="text/javascript">
        window.onload = function () {

            var username = "default userio"
            var conn;
            var msg = document.getElementById("msg");
            var log = document.getElementById("log");

            document.getElementById("startWebsock").onclick = function () {
                if (window["WebSocket"]) {
                    conn = new WebSocket("ws://" + document.location.host + "/ws?name=" + username);
                    conn.onclose = function (evt) {
                        var item = document.createElement("div");
                        item.innerHTML = "<b>Connection closed.</b>";
                        appendLog(item);
                    };
                    conn.onmessage = function (evt) {
                        var messages = evt.data.split('\n');
                        for (var i = 0; i < messages.length; i++) {
                            var item = document.createElement("div");
                            var obm = JSON.parse(messages[i])
                            item.innerText = obm["message"];
                            appendLog(item);
                        }
                    };
                } else {
                    var item = document.createElement("div");
                    item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
                    appendLog(item);
                }

            }
            document.getElementById("setunamebutton").onclick = function () {
                username = document.getElementById("unamefield").value
                appendLog(username + "has entered the chat room.")
            }

            function appendLog(item) {
                var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
                log.appendChild(item);
                if (doScroll) {
                    log.scrollTop = log.scrollHeight - log.clientHeight;
                }
            }

            document.getElementById("form").onsubmit = function () {
                if (!conn) {
                    return false;
                }
                if (!msg.value) {
                    return false;
                }
                var messy = username + ": " + msg.value;
                var finmess = JSON.stringify({message:messy});
                conn.send(finmess);
                msg.value = "";
                return false;
            };
        };

    </script>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            }

        .bodyCont {
            display: block;
            height: 1000px;
            width: 1000px;
            display: block;
            /*position: fixed;*/
            overflow: hidden;
            background: gray;
        }

        #log {
            min-width: 500px;
            max-width: 500px;
            max-height: 500px;
            min-height: 300px;
            background: white;
            /*margin: 5em;*/
            /*padding: 0.5em 0.5em 0.5em 0.5em;*/
            position: absolute;
            top: 100px;
            left: 49px;
            overflow: auto;
        }

        #form {
            display: block;
            position: absolute;
            /*left: 210px;*/
            /*top: 50px;*/
            max-width: 50%;
            min-width: 50%;

        }

        #msg {
            position: absolute;
            left: 112px;
            top: 50px;

        }

        #unamefield {
            position: absolute;
            display: block;
            top: 75px;
            left: 112px;
        }

        .unameContainer {
            /*left: 210px;*/
            /*top: 20px;*/
            /*position: absolute;*/
            max-width: 50%;
            min-width: 50%;

        }

        #allbuttons {
            display: block;
            position: absolute;
            width: 100%;

        }

        #setunamebutton {
            left: 3px;
            top: 75px;
            position: absolute;
            width: 100px;
            text-align: center;
        }

        #sendButton {
            left: 3px;
            top: 50px;
            position: absolute;
            width: 100px;
            text-align: center;
        }

        #startWebsock {
            width: 100px;
            padding: 2px;
            position: absolute;
            top: 4px;
            left: 255px;
        }

    </style>
</head>
<body>
<div class="bodyCont">
    <div id="log"></div>

    <div id="allbuttons">
        <form id="form">
            <input type="submit" value="Send" id="sendButton"/>
            <input type="text" id="msg" size="64"/>
        </form>

        <div class="unameContainer">
            <button id="setunamebutton">Set Name</button>

            <input title="username field" type="text" id="unamefield" size="64"/>
        </div>
    </div>
    <button id="startWebsock">Start Web Socket</button>

</div>
</body>
</html>